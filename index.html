<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üèê Gameday Referee Panel</title>
<style>
body { font-family: 'Inter', sans-serif; background: #0f172a; color: #f8fafc; padding: 30px; }
.container { max-width: 1000px; margin: 0 auto; }
h1 { color: #3b82f6; margin-bottom: 20px; }
.panel { background: #1e293b; padding: 20px; border-radius: 12px; border: 1px solid #334155; margin-bottom: 20px; }
label { display: block; margin-top: 10px; font-weight: 600; color: #94a3b8; }
select, input { width: 100%; padding: 8px; border-radius: 8px; border: none; background: #334155; color: #fff; margin-top: 5px; }
button { margin-top: 15px; padding: 10px 20px; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; }
button.primary { background: #3b82f6; color: white; }
button.success { background: #10b981; color: white; }
.status { margin-top: 15px; padding: 10px; border-radius: 8px; display: none; }
.status.success { background: #dcfce7; color: #166534; }
.status.error { background: #fee2e2; color: #991b1b; }
.game-row { background: #334155; padding: 15px; border-radius: 10px; margin-bottom: 15px; border: 1px solid #475569; }
</style>
</head>
<body>
<div class="container">
<h1>üèê Gameday Referee Panel</h1>

<!-- GitHub Credentials -->
<div class="panel">
    <h2>üîê GitHub Settings</h2>
    <label>Username</label><input type="text" id="githubOwner">
    <label>Repository</label><input type="text" id="githubRepo">
    <label>Personal Access Token</label><input type="password" id="githubToken">
    <label>Branch</label><input type="text" id="githubBranch" value="main">
    <button class="primary" onclick="saveGithubConfig()">üíæ Save Settings</button>
</div>

<!-- Games -->
<div class="panel">
    <h2>üéÆ Games</h2>
    <div id="gamesContainer"></div>
    <button class="primary" onclick="addGame()">‚ûï Add Game</button>
</div>

<button class="success" onclick="uploadToGitHub()">üöÄ Upload JSON to GitHub</button>
<div id="statusMessage" class="status"></div>
</div>

<script>
const teams = [
    { name: 'Œ†ŒëŒùŒëŒòŒóŒùŒëŒ™ŒöŒüŒ£ AO', logo: 'panathinaikos.png', className: 'panathinaikos' },
    { name: 'ŒüŒõŒ•ŒúŒ†ŒôŒëŒöŒüŒ£ Œ£Œ¶Œ† OŒùŒïŒß', logo: 'olympiakos.png', className: 'olympiakos' },
    { name: 'ŒëŒüŒùŒ£ ŒúŒôŒõŒ©Œù', logo: 'milon.png', className: 'milon' },
    { name: 'Œ†ŒëŒüŒö', logo: 'paok.png', className: 'paok' },
    { name: 'ŒëŒüŒ† ŒöŒóŒ¶ŒôŒ£ŒôŒëŒ£', logo: 'kifisia.png', className: 'kifisia' },
    { name: 'ŒëŒü Œ¶ŒüŒôŒùŒôŒöŒëŒ£ Œ£Œ•Œ°ŒüŒ•', logo: 'foinikas.png', className: 'foinikas' },
    { name: 'Œ†ŒëŒùŒôŒ©ŒùŒôŒüŒ£', logo: 'panionios.png', className: 'panionios' },
    { name: 'ŒëŒü Œ¶ŒõŒüŒôŒ£ŒíŒüŒ£ MEMBERS PARON', logo: 'floisvos.png', className: 'floisvos' },
    { name: 'ŒüŒ¶Œó', logo: 'ofi.png', className: 'ofi' },
    { name: 'ŒëŒü ŒöŒëŒõŒëŒúŒëŒ§Œë 80 AFFIDEA', logo: 'kalamata.png', className: 'kalamata' }
];

let games = [];

function saveGithubConfig() {
    localStorage.setItem('githubOwner', document.getElementById('githubOwner').value);
    localStorage.setItem('githubRepo', document.getElementById('githubRepo').value);
    localStorage.setItem('githubToken', document.getElementById('githubToken').value);
    localStorage.setItem('githubBranch', document.getElementById('githubBranch').value);
    showStatus('success', '‚úÖ GitHub settings saved!');
}

function showStatus(type, text) {
    const div = document.getElementById('statusMessage');
    div.className = 'status ' + type;
    div.textContent = text;
    div.style.display = 'block';
    setTimeout(()=> div.style.display='none', 4000);
}

function addGame() {
    if (games.length >= 5) return showStatus('error', 'ŒúœÄŒøœÅŒµŒØœÑŒµ ŒΩŒ± œÄœÅŒøœÉŒ∏Œ≠œÉŒµœÑŒµ ŒºœåŒΩŒø 5 œÄŒ±ŒπœáŒΩŒØŒ¥ŒπŒ±.');
    const game = { homeTeam:'', awayTeam:'', refs:{referees:[], observer:'', challengeRef:'', linesmen:[], secretariat:''} };
    games.push(game);
    renderGames();
}

function removeGame(idx) { games.splice(idx,1); renderGames(); }

function updateGame(idx, field, value, subfield=null, subidx=null) {
    if(subfield!==null){
        if(Array.isArray(games[idx].refs[subfield])){
            games[idx].refs[subfield][subidx] = value;
        } else { games[idx].refs[subfield] = value; }
    } else { games[idx][field] = value; }
}

function renderGames() {
    const container = document.getElementById('gamesContainer');
    container.innerHTML = '';
    games.forEach((g,i)=>{
        const div = document.createElement('div');
        div.className='game-row';

        const teamOptions = teams.map(t=>`<option value="${t.name}" ${g.homeTeam===t.name?'selected':''}>${t.name}</option>`).join('');

        div.innerHTML=`
            <label>Home Team</label>
            <select onchange="updateGame(${i}, 'homeTeam', this.value)">
                <option value="">Select Team</option>${teamOptions}
            </select>

            <label>Away Team</label>
            <select onchange="updateGame(${i}, 'awayTeam', this.value)">
                <option value="">Select Team</option>${teamOptions}
            </select>

            <label>Referees (comma separated)</label>
            <input type="text" value="${g.refs.referees.join(', ')}" onchange="updateGame(${i}, 'refs', this.value.split(',').map(s=>s.trim()), 'referees')">
            <label>Observer</label>
            <input type="text" value="${g.refs.observer}" onchange="updateGame(${i}, 'refs', this.value, 'observer')">
            <label>Challenge Referee</label>
            <input type="text" value="${g.refs.challengeRef}" onchange="updateGame(${i}, 'refs', this.value, 'challengeRef')">
            <label>Linesmen (comma separated)</label>
            <input type="text" value="${g.refs.linesmen.join(', ')}" onchange="updateGame(${i}, 'refs', this.value.split(',').map(s=>s.trim()), 'linesmen')">
            <label>Secretariat</label>
            <input type="text" value="${g.refs.secretariat}" onchange="updateGame(${i}, 'refs', this.value, 'secretariat')">
            <button onclick="removeGame(${i})" style="background:#ef4444;color:white;">üóëÔ∏è Remove</button>
        `;
        container.appendChild(div);
    });
}

async function uploadToGitHub() {
    const token = document.getElementById('githubToken').value;
    const owner = document.getElementById('githubOwner').value;
    const repo = document.getElementById('githubRepo').value;
    const branch = document.getElementById('githubBranch').value;
    if(!token||!owner||!repo) return showStatus('error','‚ö†Ô∏è Fill GitHub info first');

    const url=`https://api.github.com/repos/${owner}/${repo}/contents/gameday.json`;
    let sha=null;
    try { const r=await fetch(url,{headers:{Authorization:`token ${token}`, Accept:'application/vnd.github.v3+json'}}); if(r.ok){ const d=await r.json(); sha=d.sha; } } catch(e){ console.log('File does not exist, will create new'); }

    const content=btoa(unescape(encodeURIComponent(JSON.stringify({games},null,2))));
    const r2 = await fetch(url,{
        method:'PUT',
        headers:{Authorization:`token ${token}`, Accept:'application/vnd.github.v3+json'},
        body: JSON.stringify({message:'Update gameday', content, branch, ...(sha?{sha}: {})})
    });
    if(r2.ok){ showStatus('success','‚úÖ gameday.json updated!'); } else { showStatus('error','‚ùå Upload failed'); }
}
</script>
</body>
</html>
